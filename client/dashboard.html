<!DOCTYPE html>
<html>
<head>
     <meta charset="UTF-8">
     <link rel="stylesheet" href="css/style.css">
    <title>Dashboard</title>
    
</head>
<body>

<div class="container">

        <div class="card">

        <h2>Your Dictionaries</h2>
        <input id="newLanguage" placeholder="New dictionary language">
        <button onclick="createDictionary()">Create Dictionary</button>
        </div>


    <div class="card">
        <ul id="dictionaryList"></ul>
    </div>
    
</div>

<ul id="dictionaryList"></ul>

<script>
const userId = localStorage.getItem("user_id");

async function loadDictionaries() {
    const res = await fetch(`http://127.0.0.1:5000/get_dictionaries/${userId}`);
    const dictionaries = await res.json();

    const list = document.getElementById("dictionaryList");
    list.innerHTML = "";

    dictionaries.forEach(d => {
        const li = document.createElement("li");
        li.textContent = `${d.language} `;
        const btn = document.createElement("button");
        btn.textContent = "Open";
        btn.onclick = () => {
            localStorage.setItem("dictionary_id", d.id);
            localStorage.setItem("dictionary_language", d.language);
            window.location = "dictionary.html";
        };
        li.appendChild(btn);
        list.appendChild(li);
    });
}

async function createDictionary() {
    const language = document.getElementById("newLanguage").value;
    if(!language) return alert("Enter a language!");

    const res = await fetch("http://127.0.0.1:5000/create_dictionary", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({user_id: userId, language})
    });
    const data = await res.json();

    if(data.status==="success") {
        document.getElementById("newLanguage").value = "";
        loadDictionaries();
    } else {
        alert("Error creating dictionary");
    }
}

// Load dictionaries on page load
loadDictionaries();
</script>
</body>
</html>
